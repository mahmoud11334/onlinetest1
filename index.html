<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Upload site</title>
  <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Crect width='100' height='100' rx='20' ry='20' fill='%23000'/%3E%3Ctext x='50' y='65' font-size='55' font-family='Arial' fill='%23fff' text-anchor='middle'%3ECR%3C/text%3E%3C/svg%3E">

  <style>
    :root {
      --dark-black: #0a0a0a;
      --glowing-white: #ffffff;
      --dark-blue: #0d3b66;
      --dark-orange: #d95d39;
      --glowing-red: #ff4d4d;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: system-ui, -apple-system, sans-serif;
    }

    body {
      background-color: var(--dark-black);
      color: var(--glowing-white);
      min-height: 100vh;
      overflow-x: hidden;
    }

    .screen {
      display: none;
      padding: 20px;
      max-width: 800px;
      margin: 0 auto;
      position: relative;
    }

    .screen.active {
      display: block;
    }

    .back-btn {
      position: absolute;
      top: 15px;
      right: 15px;
      background: var(--dark-orange);
      color: white;
      border: none;
      width: 40px;
      height: 40px;
      border-radius: 50%;
      font-size: 18px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      text-decoration: none;
      z-index: 10;
    }

    .back-btn:hover {
      opacity: 0.85;
    }

    h1 {
      text-align: center;
      margin: 30px 0 40px;
      font-size: 28px;
      text-shadow: 0 0 10px rgba(255, 255, 255, 0.6);
    }

    .main-btn {
      display: block;
      width: 90%;
      margin: 15px auto;
      padding: 16px;
      background-color: var(--dark-orange);
      color: white;
      border: none;
      border-radius: 8px;
      font-size: 20px;
      cursor: pointer;
      text-align: center;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.4);
      transition: all 0.3s;
    }

    .main-btn:hover {
      opacity: 0.9;
      transform: translateY(-2px);
    }

    .password-form {
      max-width: 300px;
      margin: 40px auto;
      text-align: center;
    }

    .password-input {
      width: 100%;
      padding: 12px;
      margin: 10px 0;
      border-radius: 6px;
      border: 1px solid #444;
      background: #111;
      color: white;
      font-size: 18px;
    }

    .submit-btn {
      background: var(--dark-orange);
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 6px;
      cursor: pointer;
      font-size: 16px;
      margin-top: 10px;
      transition: all 0.3s;
    }

    .submit-btn:hover {
      opacity: 0.85;
    }

    .item-list {
      max-height: 70vh;
      overflow-y: auto;
      padding-right: 10px;
    }

    .item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 15px;
      background: rgba(30, 30, 30, 0.6);
      margin: 12px 0;
      border-radius: 8px;
      border-left: 4px solid var(--dark-blue);
    }

    .item-info {
      flex: 1;
    }

    .item-name {
      font-size: 18px;
      margin-bottom: 5px;
    }

    .item-uploader {
      font-size: 12px;
      color: #aaa;
    }

    .download-btn {
      background: var(--dark-blue);
      color: white;
      border: none;
      padding: 8px 16px;
      border-radius: 6px;
      cursor: pointer;
      transition: all 0.3s;
    }

    .download-btn:hover {
      opacity: 0.85;
    }

    .error {
      color: var(--glowing-red);
      text-align: center;
      margin-top: 15px;
      font-weight: bold;
      text-shadow: 0 0 8px rgba(255, 77, 77, 0.5);
    }

    .success {
      color: #4ade80;
      text-align: center;
      margin-top: 15px;
      font-weight: bold;
      text-shadow: 0 0 8px rgba(74, 222, 128, 0.5);
    }

    .item-list::-webkit-scrollbar {
      width: 8px;
    }
    .item-list::-webkit-scrollbar-track {
      background: #111;
    }
    .item-list::-webkit-scrollbar-thumb {
      background: var(--dark-orange);
      border-radius: 4px;
    }

    .online-counter {
      position: fixed;
      top: 15px;
      left: 15px;
      background: rgba(13, 59, 102, 0.8);
      padding: 8px 15px;
      border-radius: 20px;
      font-size: 14px;
      z-index: 100;
      box-shadow: 0 0 10px rgba(13, 59, 102, 0.5);
    }

    .login-form {
      max-width: 350px;
      margin: 60px auto;
      padding: 30px;
      background: rgba(30, 30, 30, 0.8);
      border-radius: 12px;
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.5);
    }

    .login-form h2 {
      text-align: center;
      margin-bottom: 25px;
      font-size: 24px;
    }

    .form-group {
      margin-bottom: 20px;
    }

    .form-group label {
      display: block;
      margin-bottom: 8px;
      font-size: 14px;
      color: #ccc;
    }

    .form-group input {
      width: 100%;
      padding: 12px;
      border-radius: 6px;
      border: 1px solid #444;
      background: #111;
      color: white;
      font-size: 16px;
    }

    .form-actions {
      display: flex;
      gap: 10px;
      margin-top: 25px;
    }

    .form-actions button {
      flex: 1;
      padding: 12px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-size: 16px;
      transition: all 0.3s;
    }

    .btn-login {
      background: var(--dark-orange);
      color: white;
    }

    .btn-register {
      background: var(--dark-blue);
      color: white;
    }

    .upload-form {
      max-width: 500px;
      margin: 20px auto;
      padding: 25px;
      background: rgba(30, 30, 30, 0.6);
      border-radius: 12px;
    }

    .file-input-wrapper {
      position: relative;
      margin: 15px 0;
    }

    .file-input-label {
      display: block;
      padding: 40px;
      border: 2px dashed #444;
      border-radius: 8px;
      text-align: center;
      cursor: pointer;
      transition: all 0.3s;
      background: rgba(20, 20, 20, 0.5);
    }

    .file-input-label:hover {
      border-color: var(--dark-orange);
      background: rgba(30, 30, 30, 0.7);
    }

    .file-input-label.has-file {
      border-color: var(--dark-blue);
      background: rgba(13, 59, 102, 0.2);
    }

    #fileInput {
      display: none;
    }

    .progress-container {
      margin: 20px 0;
      display: none;
    }

    .progress-bar {
      width: 100%;
      height: 30px;
      background: #222;
      border-radius: 15px;
      overflow: hidden;
      position: relative;
    }

    .progress-fill {
      height: 100%;
      background: linear-gradient(90deg, var(--dark-blue), var(--dark-orange));
      width: 0%;
      transition: width 0.3s;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-size: 14px;
      font-weight: bold;
    }

    .select-category {
      width: 100%;
      padding: 12px;
      margin: 15px 0;
      border-radius: 6px;
      border: 1px solid #444;
      background: #111;
      color: white;
      font-size: 16px;
      cursor: pointer;
    }

    .logout-btn {
      position: fixed;
      top: 15px;
      right: 15px;
      background: var(--glowing-red);
      color: white;
      border: none;
      padding: 8px 16px;
      border-radius: 6px;
      cursor: pointer;
      font-size: 14px;
      z-index: 100;
    }

    .loading {
      text-align: center;
      padding: 20px;
      color: #888;
    }
  </style>
</head>
<body>

  
  <div class="online-counter" id="onlineCounter">
    ğŸŸ¢ Ù…ØªØµÙ„: <span id="userCount">0</span>
  </div>

  
  <div id="loginScreen" class="screen active">
    <div class="login-form">
      <h2>ğŸ” ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</h2>
      <div class="form-group">
        <label>Ø£Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…:</label>
        <input type="email" id="loginEmail" placeholder="myname" />
      </div>
      <div class="form-group">
        <label>ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±:</label>
        <input type="password" id="loginPassword" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" />
      </div>
      <div class="form-actions">
        <button class="btn-login" onclick="loginUser()">Ø¯Ø®ÙˆÙ„</button>
        <button class="btn-register" onclick="registerUser()">ØªØ³Ø¬ÙŠÙ„ Ø¬Ø¯ÙŠØ¯</button>
      </div>
      <div id="loginError" class="error"></div>
      <div id="loginSuccess" class="success"></div>
    </div>
  </div>

  
  <button class="logout-btn" id="logoutBtn" style="display:none;" onclick="logoutUser()">ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬</button>

  
  <div id="home" class="screen">
    <h1>Ø§Ø®ØªØ± Ø§Ù„ÙˆØ¶Ø¹:</h1>
    <button class="main-btn" onclick="navigateTo('private')">Ø®Ø§Øµ</button>
    <button class="main-btn" onclick="navigateTo('public')">Ø¹Ø§Ù…</button>
    <button class="main-btn" onclick="navigateTo('secret')">Ø´Ø¯ÙŠØ¯ Ø§Ù„Ø®ØµÙˆØµÙŠØ©</button>
    <button class="main-btn" onclick="navigateTo('upload')">Ø¥Ø¶Ø§ÙØ© Ù…Ù„Ù</button>
  </div>

  
  <div id="private" class="screen">
    <a href="#" class="back-btn" onclick="goBack(); return false;">â†</a>
    <div id="private-content" style="display:none;">
      <h1>Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„Ø®Ø§ØµØ©</h1>
      <div class="item-list" id="private-items">
        <div class="loading">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</div>
      </div>
    </div>
    <div id="private-login">
      <div class="password-form">
        <h1>Ø®Ø§Øµ</h1>
        <input type="password" id="private-pw" class="password-input" placeholder="Ø£Ø¯Ø®Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±" />
        <br />
        <button class="submit-btn" onclick="checkPrivatePassword()">Ø¯Ø®ÙˆÙ„</button>
        <div id="private-error" class="error"></div>
      </div>
    </div>
  </div>

  
  <div id="public" class="screen">
    <a href="#" class="back-btn" onclick="goBack(); return false;">â†</a>
    <h1>Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„Ø¹Ø§Ù…Ø©</h1>
    <div class="item-list" id="public-items">
      <div class="loading">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</div>
    </div>
  </div>

  
  <div id="secret" class="screen">
    <a href="#" class="back-btn" onclick="goBack(); return false;">â†</a>
    <div id="secret-content" style="display:none;">
      <h1>Ø´Ø¯ÙŠØ¯ Ø§Ù„Ø®ØµÙˆØµÙŠØ©</h1>
      <div class="item-list" id="secret-items">
        <div class="loading">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</div>
      </div>
    </div>
    <div id="secret-login">
      <div class="password-form">
        <h1>Ø´Ø¯ÙŠØ¯ Ø§Ù„Ø®ØµÙˆØµÙŠØ©</h1>
        <input type="password" id="secret-pw" class="password-input" placeholder="Ø£Ø¯Ø®Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±" />
        <br />
        <button class="submit-btn" onclick="checkSecretPassword()">Ø¯Ø®ÙˆÙ„</button>
        <div id="secret-error" class="error"></div>
      </div>
    </div>
  </div>

  
  <div id="upload" class="screen">
    <a href="#" class="back-btn" onclick="goBack(); return false;">â†</a>
    <h1>Ø¥Ø¶Ø§ÙØ© Ù…Ù„Ù Ø¬Ø¯ÙŠØ¯</h1>
    <div class="upload-form">
      <div class="form-group">
        <label>Ø§Ø³Ù… Ø§Ù„Ù…Ù„Ù:</label>
        <input type="text" id="fileName" class="password-input" placeholder="Ù…Ø«Ø§Ù„: Ø¬Ø§ØªØ§ Ø³Ø§Ù† 3" />
      </div>

      <div class="file-input-wrapper">
        <label for="fileInput" class="file-input-label" id="fileLabel">
          <div>ğŸ“ Ø§Ø¶ØºØ· Ù„Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…Ù„Ù</div>
          <div style="font-size:12px; color:#888; margin-top:10px;">Ø¬Ù…ÙŠØ¹ Ø§Ù„ØµÙŠØº Ù…Ø¯Ø¹ÙˆÙ…Ø©</div>
        </label>
        <input type="file" id="fileInput" onchange="handleFileSelect()" />
      </div>

      <div class="progress-container" id="progressContainer">
        <div class="progress-bar">
          <div class="progress-fill" id="progressFill">0%</div>
        </div>
      </div>

      <div class="form-group">
        <label>Ø§Ø®ØªØ± Ø§Ù„Ù‚Ø³Ù…:</label>
        <select class="select-category" id="categorySelect">
          <option value="public">Ø¹Ø§Ù…</option>
          <option value="private">Ø®Ø§Øµ</option>
          <option value="secret">Ø´Ø¯ÙŠØ¯ Ø§Ù„Ø®ØµÙˆØµÙŠØ©</option>
        </select>
      </div>

      <button class="submit-btn" onclick="uploadFile()" style="width:100%; padding:14px; font-size:18px;">
        Ø±ÙØ¹ Ø§Ù„Ù…Ù„Ù
      </button>

      <div id="uploadError" class="error"></div>
      <div id="uploadSuccess" class="success"></div>
    </div>
  </div>

  
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-storage-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>

  <script>
    
    const firebaseConfig = {
      apiKey: "AIzaSyBffaJe4yIvtWGMB6f0FHCzwuCLSz8qJjA",
      authDomain: "upload-site-717a1.firebaseapp.com",
      databaseURL: "https://upload-site-717a1-default-rtdb.firebaseio.com",
      projectId: "upload-site-717a1",
      storageBucket: "upload-site-717a1.firebasestorage.app",
      messagingSenderId: "747184216558",
      appId: "1:747184216558:web:41293f4c050aba6ae116ff",
      measurementId: "G-GQZGYZCR9Q"
    };

    
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();
    const storage = firebase.storage();
    const rtdb = firebase.database();
    const app = initializeApp(firebaseConfig);
    const analytics = getAnalytics(app);
    let currentUser = null;
    let selectedFile = null;
    let privateAttempts = 0;
    const PRIVATE_PASSWORD = "kolyom911";
    const SECRET_PASSWORD = "kass1";

    
    auth.onAuthStateChanged(user => {
      if (user) {
        currentUser = user;
        document.getElementById('loginScreen').classList.remove('active');
        document.getElementById('home').classList.add('active');
        document.getElementById('logoutBtn').style.display = 'block';
        trackUserPresence();
        loadAllFiles();
      } else {
        currentUser = null;
        document.getElementById('loginScreen').classList.add('active');
        document.getElementById('home').classList.remove('active');
        document.getElementById('logoutBtn').style.display = 'none';
      }
    });

    
    async function loginUser() {
      const email = document.getElementById('loginEmail').value.trim();
      const password = document.getElementById('loginPassword').value;
      const errorEl = document.getElementById('loginError');
      const successEl = document.getElementById('loginSuccess');

      errorEl.textContent = '';
      successEl.textContent = '';

      if (!email || !password) {
        errorEl.textContent = 'âš ï¸ ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ ÙˆÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±';
        return;
      }

      try {
        await auth.signInWithEmailAndPassword(email, password);
        successEl.textContent = 'âœ… ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ù†Ø¬Ø§Ø­!';
      } catch (error) {
        errorEl.textContent = 'âŒ Ø®Ø·Ø£: ' + getArabicError(error.code);
      }
    }

    
    async function registerUser() {
      const email = document.getElementById('loginEmail').value.trim();
      const password = document.getElementById('loginPassword').value;
      const errorEl = document.getElementById('loginError');
      const successEl = document.getElementById('loginSuccess');

      errorEl.textContent = '';
      successEl.textContent = '';

      if (!email || !password) {
        errorEl.textContent = 'âš ï¸ ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ ÙˆÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±';
        return;
      }

      if (password.length < 6) {
        errorEl.textContent = 'âš ï¸ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ÙŠØ¬Ø¨ Ø£Ù† ØªÙƒÙˆÙ† 6 Ø£Ø­Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„';
        return;
      }

      try {
        await auth.createUserWithEmailAndPassword(email, password);
        successEl.textContent = 'âœ… ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨ Ø¨Ù†Ø¬Ø§Ø­!';
      } catch (error) {
        errorEl.textContent = 'âŒ Ø®Ø·Ø£: ' + getArabicError(error.code);
      }
    }

   
    function logoutUser() {
      auth.signOut();
    }

   
    function getArabicError(code) {
      const errors = {
        'auth/invalid-email': 'Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ ØºÙŠØ± ØµØ­ÙŠØ­',
        'auth/user-disabled': 'Ø§Ù„Ø­Ø³Ø§Ø¨ Ù…Ø¹Ø·Ù„',
        'auth/user-not-found': 'Ø§Ù„Ø­Ø³Ø§Ø¨ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯',
        'auth/wrong-password': 'ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ØºÙŠØ± ØµØ­ÙŠØ­Ø©',
        'auth/email-already-in-use': 'Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ Ù…Ø³ØªØ®Ø¯Ù… Ø¨Ø§Ù„ÙØ¹Ù„',
        'auth/weak-password': 'ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø¶Ø¹ÙŠÙØ©',
        'auth/network-request-failed': 'Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª',
        'auth/invalid-credential': 'Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¯Ø®ÙˆÙ„ ØºÙŠØ± ØµØ­ÙŠØ­Ø©'
      };
      return errors[code] || 'Ø­Ø¯Ø« Ø®Ø·Ø£ ØºÙŠØ± Ù…ØªÙˆÙ‚Ø¹';
    }

    
    function trackUserPresence() {
      const userRef = rtdb.ref('activeUsers/' + currentUser.uid);
      userRef.set(true);
      userRef.onDisconnect().remove();

      rtdb.ref('activeUsers').on('value', snapshot => {
        const count = snapshot.numChildren();
        document.getElementById('userCount').textContent = count;
      });
    }

    
    function navigateTo(screenId) {
      document.querySelectorAll('.screen').forEach(el => el.classList.remove('active'));
      document.getElementById(screenId).classList.add('active');
    }

    function goBack() {
      navigateTo('home');
    }

    
    function checkPrivatePassword() {
      const input = document.getElementById('private-pw').value;
      const errorEl = document.getElementById('private-error');

      if (input === PRIVATE_PASSWORD) {
        errorEl.textContent = "";
        document.getElementById('private-login').style.display = 'none';
        document.getElementById('private-content').style.display = 'block';
        loadFiles('private');
      } else {
        privateAttempts++;
        if (privateAttempts >= 3) {
          alert("ØªÙ… Ø¥Ø¯Ø®Ø§Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø®Ø§Ø·Ø¦Ø© 3 Ù…Ø±Ø§Øª. Ø³ÙŠØªÙ… Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„ØµÙØ­Ø©.");
          window.close();
        } else {
          errorEl.textContent = "âŒ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ØºÙŠØ± ØµØ­ÙŠØ­Ø©! Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø©: " + privateAttempts + "/3";
        }
      }
    }

    
    function checkSecretPassword() {
      const input = document.getElementById('secret-pw').value;
      const errorEl = document.getElementById('secret-error');

      if (input === SECRET_PASSWORD) {
        errorEl.textContent = "";
        document.getElementById('secret-login').style.display = 'none';
        document.getElementById('secret-content').style.display = 'block';
        loadFiles('secret');
      } else {
        alert("âŒ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ØºÙŠØ± ØµØ­ÙŠØ­Ø©. Ø³ÙŠØªÙ… Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø¢Ù†.");
        window.close();
      }
    }

    
    function loadAllFiles() {
      loadFiles('public');
    }

    
    async function loadFiles(category) {
      const container = document.getElementById(category + '-items');
      container.innerHTML = '<div class="loading">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</div>';

      try {
        const snapshot = await db.collection('files')
          .where('category', '==', category)
          .orderBy('timestamp', 'desc')
          .get();

        container.innerHTML = '';

        if (snapshot.empty) {
          container.innerHTML = '<div class="loading">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù„ÙØ§Øª Ø­ØªÙ‰ Ø§Ù„Ø¢Ù†</div>';
          return;
        }

        snapshot.forEach(doc => {
          const data = doc.data();
          addItemToUI(container, data.name, data.downloadURL, data.uploaderEmail);
        });
      } catch (error) {
        container.innerHTML = '<div class="error">âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„: ' + error.message + '</div>';
      }
    }

    
    function addItemToUI(container, name, downloadURL, uploaderEmail) {
      const div = document.createElement('div');
      div.className = 'item';
      div.innerHTML = `
        <div class="item-info">
          <div class="item-name">${name}</div>
          <div class="item-uploader">Ø±ÙØ¹ Ø¨ÙˆØ§Ø³Ø·Ø©: ${uploaderEmail}</div>
        </div>
        <button class="download-btn" onclick="downloadFile('${downloadURL}', '${name}')">ØªØ­Ù…ÙŠÙ„</button>
      `;
      container.appendChild(div);
    }

   
    function downloadFile(url, filename) {
      const link = document.createElement('a');
      link.href = url;
      link.download = filename;
      link.target = '_blank';
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
    }

   
    function handleFileSelect() {
      selectedFile = document.getElementById('fileInput').files[0];
      const label = document.getElementById('fileLabel');
      
      if (selectedFile) {
        const sizeMB = (selectedFile.size / (1024 * 1024)).toFixed(2);
        label.innerHTML = `
          <div>âœ… ØªÙ… Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…Ù„Ù</div>
          <div style="font-size:14px; color:#4ade80; margin-top:10px;">${selectedFile.name}</div>
          <div style="font-size:12px; color:#888; margin-top:5px;">Ø§Ù„Ø­Ø¬Ù…: ${sizeMB} MB</div>
        `;
        label.classList.add('has-file');
      }
    }

    
    async function uploadFile() {
      const fileName = document.getElementById('fileName').value.trim();
      const category = document.getElementById('categorySelect').value;
      const errorEl = document.getElementById('uploadError');
      const successEl = document.getElementById('uploadSuccess');

      errorEl.textContent = '';
      successEl.textContent = '';

      
      if (!fileName) {
        errorEl.textContent = 'âš ï¸ ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ù„Ù';
        return;
      }

      if (!selectedFile) {
        errorEl.textContent = 'âš ï¸ ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ù…Ù„Ù Ù„Ù„Ø±ÙØ¹';
        return;
      }

      
      if (category === 'private') {
        const pw = prompt('Ø£Ø¯Ø®Ù„ ÙƒÙ„Ù…Ø© Ù…Ø±ÙˆØ± Ù‚Ø³Ù… Ø®Ø§Øµ:');
        if (pw !== PRIVATE_PASSWORD) {
          errorEl.textContent = 'âŒ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ØºÙŠØ± ØµØ­ÙŠØ­Ø©!';
          return;
        }
      } else if (category === 'secret') {
        const pw = prompt('Ø£Ø¯Ø®Ù„ ÙƒÙ„Ù…Ø© Ù…Ø±ÙˆØ± Ù‚Ø³Ù… Ø´Ø¯ÙŠØ¯ Ø§Ù„Ø®ØµÙˆØµÙŠØ©:');
        if (pw !== SECRET_PASSWORD) {
          errorEl.textContent = 'âŒ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ØºÙŠØ± ØµØ­ÙŠØ­Ø©!';
          return;
        }
      }

      try {
        
        const progressContainer = document.getElementById('progressContainer');
        const progressFill = document.getElementById('progressFill');
        progressContainer.style.display = 'block';

        
        const timestamp = Date.now();
        const storageRef = storage.ref(`files/${category}/${timestamp}_${selectedFile.name}`);
        const uploadTask = storageRef.put(selectedFile);

        uploadTask.on('state_changed',
          (snapshot) => {
            const progress = (snapshot.bytesTransferred / snapshot.totalBytes) * 100;
            progressFill.style.width = progress + '%';
            progressFill.textContent = Math.round(progress) + '%';
          },
          (error) => {
            errorEl.textContent = 'âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø±ÙØ¹: ' + error.message;
            progressContainer.style.display = 'none';
          },
          async () => {
            
            const downloadURL = await uploadTask.snapshot.ref.getDownloadURL();

            
            await db.collection('files').add({
              name: fileName,
              originalFileName: selectedFile.name,
              downloadURL: downloadURL,
              category: category,
              uploaderEmail: currentUser.email,
              uploaderId: currentUser.uid,
              timestamp: firebase.firestore.FieldValue.serverTimestamp(),
              size: selectedFile.size
            });

            
            progressContainer.style.display = 'none';
            progressFill.style.width = '0%';

            
            successEl.textContent = 'âœ… ØªÙ… Ø±ÙØ¹ Ø§Ù„Ù…Ù„Ù Ø¨Ù†Ø¬Ø§Ø­!';
            
            
            document.getElementById('fileName').value = '';
            document.getElementById('fileInput').value = '';
            selectedFile = null;
            document.getElementById('fileLabel').innerHTML = `
              <div>ğŸ“ Ø§Ø¶ØºØ· Ù„Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…Ù„Ù</div>
              <div style="font-size:12px; color:#888; margin-top:10px;">Ø¬Ù…ÙŠØ¹ Ø§Ù„ØµÙŠØº Ù…Ø¯Ø¹ÙˆÙ…Ø©</div>
            `;
            document.getElementById('fileLabel').classList.remove('has-file');

            
            loadFiles(category);

            
            setTimeout(() => {
              navigateTo('home');
              successEl.textContent = '';
            }, 2000);
          }
        );
      } catch (error) {
        errorEl.textContent = 'âŒ Ø®Ø·Ø£: ' + error.message;
        document.getElementById('progressContainer').style.display = 'none';
      }
    }
  </script>
</body>
</html>